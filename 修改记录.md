# 修改记录（编辑中）

#### UpdateTime:2024.9.23 (Ver 0.0.1(test))

- 适配了下V1事件

> 因为审批状态变更事件目前只有V1版本

- ~~赋能~~使能通过卡片申请物品操作

- 添加/search命令

**目前实现的功能：**

- 通过信息卡片进行申请物资操作

- 实现增删功能

> 发送消息

**Todo:**

- 设置小程序，实现扫码取还增改物品

- ~~采用异步方法，防止消息堵塞~~

- 数据库定时备份&同步至云文档内

- 批量删除

- 分页显示

- add:使用json格式发送小程序卡片，以创造更个性化的卡片

- ...

#### UpdateTime:2024.9.22

- 实现增删功能

- 完善api实现

- 调整logs表列定义

- 管理管理员权限

> {'op {{@user_name}}':<{margin}} \t给予管理员权限

> {'deop {{@user_name}}':<{margin}} \t取消管理员权限

> {'lsop {{@user_name}}':<{margin}} \t列出管理员列表

**目前实现的功能：**

- 通过信息卡片进行申请物资操作

- 实现增删功能

> 发送消息/信息卡片/小程序 任选，先实现功能再优化

**Todo:**

- ~~调用审批接口处理申请物资请求~~

- 设置小程序，实现扫码取还增改物品

- ~~采用异步方法，防止消息堵塞~~

- add:添加/search命令

- add:数据库定时备份&同步至云文档内

- add:批量删除

- add:分页显示

- ...


#### UpdateTime:2024.9.21

- 优化`从电子表格初始化物资`和`从通讯录中获取成员列表`功能，加入MD5校验（存在`表logs`内，避免每次重启服务端都要遍历一边数据，节省资源

- 调整`table`的设置

- 优化消息卡片，两张卡片json格式均在`./card_example.json`

- 优化目录结构(除`server.py`和`init.py`，其余脚本文件存入`./scripts`)

- 优化api接口实现

- Sheet的信息从`.env`转移到`settings.json`

**目前实现的功能：**

- 通过机器人菜单可唤出物资仓库，通过消息卡片检查物资信息

- 启动时自动同步云空间内电子表格数据

**Todo:**

- done~~通过信息卡片进行申请物资操作~~

- ~~调用审批接口处理申请物资请求~~

- done~~实现增删功能~~

> ~~发送消息/信息卡片/小程序 任选，先实现功能再优化~~

- ~~设置小程序，实现扫码取还增改物品~~

- ~~采用异步方法，防止消息堵塞~~

- ...

#### UpdateTime:2024.9.20

- 加入了从`通讯录`中获取成员列表的功能

- 加入了从`电子表格`中初始化物资信息的功能，`init.py`中的设置初值功能已注释

> **Tips：*使用此功能请记得在`.env`文件中配置存储物资信息的电子表格的

> `SHEET_TOKEN`to`ITEM_SHEET_TOKEN`

> 什么是`SHEET_TOKEN`请查找飞书的开发者文档。

> 关于获取`SHEET_TOKEN`，我采用的办法是在电脑端飞书-云文档-侧栏（如没有请单机左上角按钮`三`）-我的文档库-找到你想获取TOKEN的文档-右键-分享-复制链接

> 此时的链接就是开发者文档中`.../sheets/...`的格式了

> 对于电子表格中的物资信息有如下规则：

> - 第一行可自定义

> - 从第二行开始，各列有自己的含义：

> - A:类型， B:名称， C:总数， D:损坏数（不可用）

> - 从第二行到最后一行始终保持该规律，其中AB列不能存在空值

> TODO 通过搜索云空间自行找到物资储物表

以上功能均需要开启对应权限

- 偷懒只写了通过`user_id`进行各种操作，如需使用`open_id`等其他类型区分用户，请自己添加

- 修改了机器人菜单,目前菜单事件仅有`物资查询`-`custom_menu.inspect.items`

- 修改了飞书卡片-保存至`./card_example.json`

> 飞书卡片在旧版本飞书中存在不兼容情况（具体表现为左侧按钮被遮住），需要更新至 `V6.8及以上版本`